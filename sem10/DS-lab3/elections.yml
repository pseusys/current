templates:

  node:
    one_shot: False
    variables:
      id: NODE_ID
      started: False
    in_channels:
      - input
      - starter
    out_channels:
      - output
    rules:
      start:
        channel: starter
        if: 'message.text == "START" and not self.started'
        send:
          channel: output
          message:
            text: PING
        set:
          started: True
      receive_ping:
        channel: input
        if: 'message.text == "PING"'
        send:
          channel: output
          message:
            text: PONG
        set:
          started: True
      receive_pong:
        channel: input
        if: 'message.text == "PONG"'
        send:
          channel: output
          message:
            text: PING

  firestarter:
    one_shot: True
    out_channels:
      - torch
    init:
      send:
        channel: torch
        message:
          text: START



matrix:

  pinger:
    template: node
    channels:
      input: first
      output: second
      starter: outer

  ponger:
    template: node
    channels:
      input: second
      output: first
      starter: outer

  launcher:
    template: firestarter
    channels:
      torch: outer
